function e(){return indexedDB.open("MeeExtensionDB",7)}async function n(n){return new Promise(((t,o)=>{const c=e();c.onerror=e=>{o()},c.onsuccess=function(e){const c=e.target.result,s=c.transaction(["domains"],"readwrite").objectStore("domains").get(n);s.onerror=e=>{o()},s.onsuccess=e=>{t(e.target.result)},c.close()}}))}async function t(n){return new Promise(((t,o)=>{const c=e();c.onerror=e=>{o()},c.onsuccess=function(e){const c=e.target.result,s=c.transaction(["domains"],"readwrite").objectStore("domains"),a=s.get(n);a.onerror=e=>{c.close(),o()},a.onsuccess=e=>{const a=e.target.result,i={domain:n,wellknown:!!a&&a.wellknown,enabled:!!a&&!a.enabled},r=s.put(i);r.onerror=e=>{c.close(),o()},r.onsuccess=e=>{c.close(),t(!0)}}}}))}function o(){return new Promise(((e,n)=>{try{chrome.tabs.query({active:!0,currentWindow:!0},(function(n){let t=n[0],o=new URL(t.url).hostname.replace("www.","");e(o)}))}catch(t){n()}}))}async function c(e,t=null){const o=function(e,n=null){return e?e.enabled:!(!n||!n.gpc)}(await n(e),t);s(),document.getElementById("slider-item").checked=o}async function s(){const e=await n("meeExtension");return!e||e.enabled}async function a(){const e=await s();document.getElementById("slider").checked=e,document.getElementById("domain-container").style.display=e?"flex":"none"}async function i(){const e=await o();console.log(e),chrome.runtime.sendMessage({msg:"APP_COMMUNICATION",type:"GET_DOMAIN_STATUS",data:e}).then((e=>{e.hasConnection?document.getElementById("has-connection").innerHTML=" true":document.getElementById("has-connection").innerHTML=" false"}))}chrome.runtime.onMessage.addListener((async function(e,n,t){const s=await o();if("SEND_WELLKNOWN_TO_POPUP"===e.msg){let{domain:n,wellknownData:t}=e.data;n===s&&c(s,t)}})),document.addEventListener("DOMContentLoaded",(async e=>{const n=await o();document.getElementById("current-domain").innerHTML=n||"Undefined",document.getElementById("has-connection-button").onclick=()=>{console.log("click"),i()},chrome.runtime.sendMessage({msg:"POPUP_LOADED",data:null}),await c(n),await a(),await i()})),document.getElementById("slider-item").addEventListener("click",(async e=>{const n=await o();await t(n)&&(chrome.runtime.sendMessage({msg:"UPDATE_SELECTOR"}),c(n))})),document.getElementById("slider").addEventListener("click",(async e=>{const n=await o();await t("meeExtension")&&(chrome.runtime.sendMessage({msg:"UPDATE_ENABLED"}),c(n)),await a()}));
